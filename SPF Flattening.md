$ spfcheck() {
→   local domain="$1"
→   local spf=$(dig +short TXT "$domain" | tr -d '"')
→
→   # Recursively handle include: mechanisms
→   echo "$spf" | grep -oE 'include:[^ ]+' | cut -d: -f2 | while read -r inc; do→     spfcheck "$inc"
→   done
→
→   # Correctly extract ip4 and ip6 blocks
→   echo "$spf" | grep -oE 'ip[46]:[^ ]+' | sed -E 's/^ip[46]://'
→ }

tj at Mac in ~
$ spfcheck macroairfans.com | sort -u

103.151.192.0/23
104.130.122.0/23
104.130.96.0/28
104.209.35.28
108.177.8.0/21
108.177.96.0/19
13.64.55.16/28
130.211.0.0/22
141.193.32.0/23
143.55.224.0/21
143.55.232.0/22
143.55.236.0/22
146.20.112.0/26
146.20.113.0/24
146.20.191.0/24
159.112.240.0/20
159.135.132.128/25
159.135.140.80/29
159.135.224.0/20
161.38.192.0/20
161.38.204.0/22
166.78.68.0/22
172.217.0.0/19
172.217.128.0/19
172.217.160.0/20
172.217.192.0/19
172.217.32.0/20
172.253.112.0/20
172.253.56.0/21
173.194.0.0/16
185.12.80.0/22
185.189.236.0/22
185.211.120.0/22
185.250.236.0/22
188.172.128.0/20
191.237.4.149
192.161.144.0/20
192.237.158.0/23
198.244.48.0/20
198.244.60.0/22
198.61.254.0/23
199.89.0.0/21
2001:4860:4000::/36
204.220.160.0/21
204.220.168.0/21
204.220.176.0/20
209.61.151.0/24
209.85.128.0/17
216.198.0.0/18
216.239.32.0/19
216.58.192.0/19
23.100.16.236
23.100.38.75
23.253.182.0/23
2404:6800:4000::/36
2607:f8b0:4000::/36
2800:3f0:4000::/36
2a00:1450:4000::/36
2c0f:fb50:4000::/36
35.190.247.0/24
35.191.0.0/16
52.226.94.192/28
64.233.160.0/19
66.102.0.0/20
66.249.80.0/20
69.72.32.0/20
72.14.192.0/18
74.125.0.0/16
87.253.232.0/21